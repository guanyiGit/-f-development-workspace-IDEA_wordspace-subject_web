<template>
    <div class="centoer">
        <p class="title">活动管理>新增</p>
       <div class="btns">
           <template v-if="!checked">
               <el-button type="primary" size="mini" @click="save">保存</el-button>
           </template>
            <template v-if="checked">
                <el-button  type="primary" size="mini" @click="release">发布</el-button>
            </template>

            <el-button type="warning" size="mini" @click="cancel">取消</el-button>
        </div>
       <div class="tablPerp">
             <div class="wai">
                 <div class="nei">
                     <div class="ovh">
                         <div class="mgt10 ww60">
                             <span class="db w100 fl h40 lh40 cor0 pdl30">活动名称:</span>
                             <div class="mgl100">
                                 <input v-model="insertExam.examName" type="text" class="ww100 h40 lh40 pdl20 borf1 ras4" style="width: 400px">
                             </div>
                         </div>
                     </div>
                     <div class="ovh">
                         <div class="mgt10 ww60">
                             <span class="db w100 fl h40 lh40 cor0 pdl30">活动分类:</span>
                             <div class="mgl100">
                                 <select v-model="insertExam.examType" id="color" type="text" class="ww100 h40 lh40 pdl20 borf1 ras4" style="width: 400px">
                                     <option value="0">问卷调查</option>
                                     <option value="1">在线考试</option>
                                     <option value="2">知识竞赛</option>
                                 </select>
                             </div>
                         </div>
                     </div>
                     <div class="ovh">
                         <div class="mgt10 ww50">
                             <span class="db w100 fl h40 lh40 cor0 pdl30">活动试卷:</span>
                             <div class="mgl100">
                                 <input v-model="paperName" type="text" class="ww100 h40 lh40 pdl20 borf1 ras4" style="width: 400px">
                                 <img @click.prevent="check" src="./search30.png" style="z-index: 999;margin-top: 4px;margin-left: -40px">
                             </div>
                         </div>
                     </div>
                     <div class="ovh">
                         <div class="mgt10 ww50">
                             <span class="db w100 fl h40 lh40 cor0 pdl30">答题次数:</span>
                             <div class="mgl100">
                                     <el-radio v-model="radio" :label=0>无限次</el-radio>
                                     <el-radio v-model="radio" :label=1>有限次</el-radio>

                                 <input  v-if="radio==1" v-model="insertExam.answersNumber" type="text" class="ww10 h40 lh40 pdl20 borf1 ras4" placeholder="次">
                             </div>
                         </div>
                     </div>
                     <div class="ovh">
                         <div class="mgt10 ww50">
                             <span class="db w100 fl h40 lh40 cor0 pdl30">活动时长:</span>
                             <div class="mgl100">
                                 <el-radio v-model="radio2" :label=0>不限时长</el-radio>
                                 <el-radio v-model="radio2" :label=1>限制时长</el-radio>
                                 <input  v-if="radio2==1" v-model="insertExam.examTime" type="text" class="ww10 h40 lh40 pdl20 borf1 ras4" placeholder="分钟">
                             </div>
                         </div>
                     </div>
                     <div class="ovh">
                         <div class="mgt10 ww50">
                             <span class="db w100 fl h40 lh40 cor0 pdl30">及格分数:</span>
                             <div class="mgl100">
                                 <input type="text" class="ww100 h40 lh40 pdl20 borf1 ras4" style="width: 400px">
                             </div>
                         </div>
                     </div>
                     <div class="ovh">
                         <div class="mgt10 ww50">
                             <span class="db w100 fl h40 lh40 cor0 pdl30">回看设置:</span>
                             <div class="mgl100">
                                 <el-radio v-model="insertExam.echoSetting" :label=0>显示正确答案</el-radio>
                                 <el-radio v-model="insertExam.echoSetting" :label=1>不显示正确答案</el-radio>
                             </div>
                         </div>
                     </div>
                     <div class="ovh">
                         <div class="mgt10 ww50">
                             <span class="db w100 fl h40 lh40 cor0 pdl30">考试生效时间:</span>
                             <div class="mgl100">
                                 <el-date-picker :disabled="checked" v-model="insertExam.effectDate"  name="startTime" type="datetime" placeholder="选择日期"
                                                  format="yyyy-MM-dd HH:mm:ss">
                                 </el-date-picker>
                                 <el-checkbox v-model="checked">发布即生效</el-checkbox>
                             </div>
                         </div>
                     </div>
                     <div class="ovh">
                         <div class="mgt10 ww50">
                             <span class="db w100 fl h40 lh40 cor0 pdl30">考试失效时间:</span>
                             <div class="mgl100">
                                 <el-date-picker :disabled="checked2"  v-model="insertExam.failureDate"  name="startTime" type="datetime" placeholder="选择日期"
                                                  format="yyyy-MM-dd HH:mm:ss">
                                 </el-date-picker>
                                 <el-checkbox v-model="checked2">手动关闭</el-checkbox>
                             </div>
                         </div>
                     </div>
                     <div class="ovh">
                         <div class="mgt10 ww50">
                             <span class="db w100 fl h40 lh40 cor0 pdl30">考试说明:</span>
                             <div class="mgl100">
                                 <input type="text" class="ww100 h40 lh40 pdl20 borf1 ras4" style="width: 400px">
                             </div>
                         </div>
                     </div>
                 </div>
             </div>
         </div>
        <!--弹窗start   说明。-->
       <div v-show="frameShow" class="point frameSize" style="display: none;z-index: 100">
            <div class="tan6 abs bgw k3 db ww100" style="height: 340px">
                <p class="ww100 h30" style="background-color: #319D8E"><span style="color:white;margin-left: 10px;font-size: 16px">查找试卷</span></p>
                <!--<form class="fr db w380 h40 borbfbfbf ras20 rel mgt5">
                    <input type="text" class="db ww100 h38 lh38 pdl15 cor3c3c3c bort"  @keyup.enter="check" placeholder="试卷名称">
                    <input value="" class="in1 db abs z100 top0 bort right0" @click="check">
                </form>-->
                <div class="mgt50 k3">
                    <table class="table5 t-c">
                        <thead>
                        <tr>
                            <td class="cor0 h60 bgf1 ww5"></td>
                            <td class="cor0 h60 bgf1">试卷名称</td>
                            <td class="cor0 h60 bgf1">题目个数</td>
                            <td class="cor0 h60 bgf1">总分</td>
                            <td class="cor0 h60 bgf1">创建人</td>
                            <td class="cor0 h60 bgf1">创建时间</td>
                        </tr>
                        </thead>
                        <tbody id="tbod">
                        <tr v-for="(item,index) in paperList" :key="index">
                            <td class="ww5">
                                <label class="lab3 mgr40">
                                <el-radio v-model="insertExam.paperId" :label=item.paperId @change="(value)=>changeHandler(value, item.paperName)">&nbsp;</el-radio>
                                </label>
                            </td>
                            <td>{{item.paperName}}</td>
                            <td>{{item.paperNumber}}</td>
                            <td>{{item.paperTotalScore}}</td>
                            <td>{{item.paperCreaterName}}</td>
                            <td>{{item.paperCreateTime | formatDate()}}</td>

                        </tr>
                        </tbody>
                    </table>
                </div>
                <!--分页-->
                <pageVue :pageData="pageData"  @chekdpageCallcak="changedPage"></pageVue>
                <!--分页&ndash;&gt;-->
                <div class="t-c mgt40 mgb50">
                    <a style="cursor:pointer;background-color: #319D8E" class="dinb w140 h40 lh40 t-c corw  ras4 hov8 bort" @click="selectPaper"><span style="color: white">确定</span></a>
                    <a style="cursor:pointer;" class="dinb w140 h40 lh40 t-c cor01 bgf1 ras4 hov8" @click="tableCancel">取消</a>
                </div>
            </div>
        </div>
        <!--弹窗END-->
    </div>
</template>

<script>
    export default {
        name: "addActiviti",
        data() {
            return {
                paperName:null,
                radio:0,
                radio2:0,
                checked:false,
                checked2:false,
                insertExam:{//请求参数

             examType:0,

            examName:null,

            paperId:null,

             answersNumber:null,//不限次数

             examTime:null,//不限时长

             passScore:null,

            echoSetting:0,//显示正确答案

            effectDate:null,

            failureDate:null,

            examExplain:null,

            examStatus:0,

            examCreater:0
        },
                frameShow:false,
                paperList:[],
                count:0,
                params:{
                    paperType:0,
                    paperMode:0,
                    input:null,
                    num:1,
                    size:5
                }

            }
        },
        created() {
            //initData(this)
        },
        mounted() {

        },
        computed: {
            pageData() {
                return {
                    curPage: this.params.num,//当前页吗
                    totalCount: this.count,//总条数
                    pageSize: this.params.size,//页面大小}

                }
            },
        },
        methods:{

            save: function(){
                add(this)
            },
            release:function () {
              add(this)
            },
            check:function(){
                this.frameShow=true;
                initPaperList(this);
            },
            selectPaper:function () {
                this.frameShow=false;
            },
            tableCancel:function () {
                this.frameShow=false;
                this.insertExam.paperId=null;
                this.paperName=null;
            },
            changedPage:function (num) {
                this.params.num = num;

            },
            changeHandler(val,paperName) {
                this.paperName=paperName;
            },
            cancel:function () {
                this.$router.go(-1);
            }
        },
        watch:{
            "radio":function () {
                if(this.radio==0){
                    this.insertExam.answersNumber=null;
                }
            },
            "radio2":function () {
                if(this.radio2==0){
                    this.insertExam.examTime=null;
                }
            }
        }
    }

   /* function findPaperById(_this){
        _this.$axios({
            method: 'post',
            url: '/biz/testPaperLib/findPaperById',
            params:{id:_this.insertExam.paperId}
        }).then((res) => {
            debugger
            if (res.code==200 && res.obj !=null) {
                _this.paperList=res.obj.list;
                _this.count=res.obj.total;
            }else {
                _this.$alert('操作失败!')
            }
        }).catch((err) => {
            console.log(err);
        })
    }*/


    function initPaperList(_this){
        _this.$axios({
            method: 'post',
            url: '/biz/testPaperLib/selectDogCardHandleList',
            params: _this.params
        }).then((res) => {
            debugger
            if (res.code==200 && res.obj !=null) {
                _this.paperList=res.obj.list;
                _this.count=res.obj.total;
            }else {
                _this.$alert('操作失败!')
            }
        }).catch((err) => {
            console.log(err);
        })
    }





    //新增考试
    function add(_this) {
        if(_this.checked==true){
            //发布考试
            _this.insertExam.effectDate= new Date();
            _this.insertExam.examStatus= 1;
        }
        _this.$axios({
            method: 'post',
            url: '/biz/activity/insertExam',
            params: _this.insertExam
        }).then((res) => {
            // debugger
            // if (res.code==200 && res.obj !=0) {
            //     _this.$alert('操作成功!').then(_ => {
            //         _this.$router.push("Exam");
            //     }).catch(_ => {
            //     });
            // }else {
            //     _this.$alert('操作失败!')
            // }
        }).catch((err) => {
            console.log(err);
        })
    }
</script>

<style scoped>
    .point{position:absolute;left:27%; top:20%;}
    .frameSize{height:50%;width:50%}
</style>